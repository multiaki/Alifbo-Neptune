// Generated by CoffeeScript 1.6.3
(function(){Neptune.accountController=Ember.ArrayController.create({init:function(){this.setUser();return this._super()},isLoggedIn:!1,user:null,fbLogin:function(e){var t=this;return Neptune.parseDataSource.fbLogin(function(n,r){var i;if(!r){t.setUser();e(t.user,null);i=t.user;return FB.api("/me",function(t){var n=this;i.firstName=t.first_name;i.lastName=t.last_name;return Neptune.parseDataSource.updateUser(i,function(t,n){Neptune.accountController.setUser();return e(t,n)})})}return e(null,Neptune.parseDataSource.getError(-1,"Email or password is incorrect","ERROR","Neptune.AccountController-login"))})},login:function(e,t){var n,r=this;n="";if(e.username===null||e.username.length===0)n="Please enter your email address";if(e.password===null||e.password.length===0)n="Please enter your password";return n.length===0?Neptune.parseDataSource.login(e.username,e.password,function(e,n){if(!n){r.setUser();return t(r.user,null)}return t(null,Neptune.parseDataSource.getError(-1,"Email or password is incorrect","ERROR","Neptune.AccountController-login"))}):t(null,Neptune.parseDataSource.getError(-1,n,"ERROR","Neptune.AccountController-login"))},logout:function(){Neptune.parseDataSource.logout();return this.setUser()},register:function(e,t){var n,r=this;n="";if(e.firstName===null||e.firstName.length===0)n="Please specify a first name";if(e.lastName===null||e.lastName.length===0)n="Please specify a last name";if(e.email===null||e.email.length===0)n="Please specify an email address";if(e.password===null||e.password.length===0)n="Please specify a password";return n.length===0?Neptune.parseDataSource.register(e,function(n,i){return i?t(null,Neptune.parseDataSource.getError(i.code,i.message,"ERROR","Neptune.AccountController-register")):Neptune.parseDataSource.login(e.email,e.password,function(e,n){return n?t(null,Neptune.parseDataSource.getError(n.code,n.message,"ERROR","Neptune.AccountController-register")):t(r.setUser(),null)})}):t(null,Neptune.parseDataSource.getError(-1,n,"ERROR","Neptune.AccountController-register"))},requestPasswordReset:function(e,t){return Neptune.parseDataSource.requestPasswordReset(e.email,function(e,n){return t(e,n)})},updateUser:function(e,t){var n=this;this.set("user.firstName",e.firstName);this.set("user.lastName",e.lastName);return Neptune.parseDataSource.updateUser(e,function(e,r){n.setUser();return t(e,r)})},setUser:function(){this.set("user",Neptune.parseDataSource.getCurrentUser());this.set("isLoggedIn",this.user!=null);return this.user}})}).call(this);