// Generated by CoffeeScript 1.6.3
(function(){Neptune.parseDataSource=Ember.Object.create({init:function(){this._super();Parse.initialize(this.parseApplicationId,this.parseJavaScriptKey);(function(e){var t,n,r;n=void 0;t="facebook-jssdk";r=e.getElementsByTagName("script")[0];if(e.getElementById(t))return;n=e.createElement("script");n.id=t;n.async=!0;n.src="//connect.facebook.net/en_US/all.js";return r.parentNode.insertBefore(n,r)})(document);return window.fbAsyncInit=function(){return Parse.FacebookUtils.init({appId:"650765618296184",cookie:!0,xfbml:!1})}},parseApplicationId:"jRt3oPjIvmawp4zdZdFXgH93X9Rir9CT3wPaJhkK",parseJavaScriptKey:"wNiz7v3vAD6EH5p5B65oBxqgeF5E5Tb3mI3r66tf",login:function(e,t,n){var r=this;return Parse.User.logIn(e,t,{success:function(e){return n(r.getCurrentUser,null)},error:function(e){return n(null,r.getError(e.code,e.message,"ERROR","Neptune.parseDataSource-login"))}})},fbLogin:function(e){return Parse.FacebookUtils.logIn(null,{success:function(t){return t.existed()?e(t,null):e(t,null)},error:function(t,n){return e(null,this.getError(n.code,n.message,"ERROR","Neptune.parseDataSource-login"))}})},logout:function(){return Parse.User.logOut()},register:function(e,t){var n,r=this;n=new Parse.User;n.set("username",e.email);n.set("password",e.password);n.set("firstName",e.firstName);n.set("lastName",e.lastName);n.set("email",e.email);return n.signUp(null,{success:function(e){return t(e,null)},error:function(e){return t(null,r.getError(e.code,e.message,"ERROR","Neptune.parseDataSource-register"))}})},requestPasswordReset:function(e,t){var n=this;return Parse.User.requestPasswordReset(e,{success:function(){return t(null,null)},error:function(e){return t(null,n.getError(e.code,e.message,"ERROR","Neptune.parseDataSource-requestPasswordReset"))}})},updateUser:function(e,t){var n,r=this;n=Parse.User.current();if(n){n.set("username",n.get("username"));n.set("email",n.get("email"));n.set("firstName",e.firstName);n.set("lastName",e.lastName);return n.save(null,{success:function(e){return t(r.getCurrentUser(),null)},error:function(e){return t(null,getError(e.code,e.message,"Neptune.parseDataSource-updateUser"))}})}return t(data,this.getError(null,"No user found","Neptune.parseDataSource-updateUser"))},getCurrentUser:function(){return Parse.User.current()?Neptune.User.create({objectId:Parse.User.current().id,userName:Parse.User.current().attributes.username,firstName:Parse.User.current().attributes.firstName,lastName:Parse.User.current().attributes.lastName}):null},getEmailMessages:function(e){var t,n,r=this;t=Parse.Object.extend("EmailMessage");n=new Parse.Query(t);n.descending("updatedAt");n.equalTo("user",Parse.User.current());return n.find({success:function(t){var n,i,s,o,u,a,f;s=Ember.makeArray();u=r.getCurrentUser();for(n=a=0,f=t.length;0<=f?a<f:a>f;n=0<=f?++a:--a){o=t[n];i=Neptune.EmailMessage.create({objectId:o.id,fromUser:u,toEmail:o.attributes.toEmail,subject:o.attributes.subject,body:o.attributes.body});s.pushObject(i)}return e(s,null)},error:function(t){return e(null,r.getError(t.code,t.message,"Neptune.parseDataSource-getEmailMessages"))}})},getSmsMessages:function(e){var t,n,r=this;t=Parse.Object.extend("SmsMessage");n=new Parse.Query(t);n.descending("updatedAt");n.equalTo("user",Parse.User.current());return n.find({success:function(t){var n,i,s,o,u,a,f;s=Ember.makeArray();u=r.getCurrentUser();for(n=a=0,f=t.length;0<=f?a<f:a>f;n=0<=f?++a:--a){o=t[n];i=Neptune.SmsMessage.create({objectId:o.id,fromUser:u,toPhoneNumber:o.attributes.toPhoneNumber,message:o.attributes.message});s.pushObject(i)}return e(s,null)},error:function(t){return e(null,r.getError(t.code,t.message,"Neptune.parseDataSource-getSmsMessages"))}})},sendEmailMessage:function(e,t){var n,r,i=this;n=Parse.Object.extend("EmailMessage");r=new n;r.set("user",Parse.User.current());r.set("toEmail",e.toEmail);r.set("subject",e.subject);r.set("body",e.body);return r.save(null,{success:function(n){e.objectId=n.id;return t(e,null)},error:function(e){return t(null,i.getError(e.code,e.message,"Neptune.parseDataSource-sendEmailMessage"))}})},sendSmsMessage:function(e,t){var n,r,i=this;n=Parse.Object.extend("SmsMessage");r=new n;r.set("user",Parse.User.current());r.set("toPhoneNumber",e.toPhoneNumber);r.set("message",e.message);return r.save(null,{success:function(n){e.objectId=n.id;return t(e,null)},error:function(e){return t(null,i.getError(e.code,e.message,"Neptune.parseDataSource-sendSmsMessage"))}})},getError:function(e,t,n,r,i){var s,o,u;o=Neptune.Error.create({code:e,severity:n,location:r,message:t});Neptune.ApplicationController.debug&&console.log("Neptune - "+n+" - Code: "+e+" Message: "+t+" Location: "+r);s=Parse.Object.extend("ErrorLog");u=new s;u.set("code",e);u.set("severity",n);u.set("location",r);u.set("message",t);u.save(null);return o}})}).call(this);